# $6$ 分做法

直接模拟。

# $42 \sim 74$ 分做法

莫队。

# $100$ 分危险做法

可持久化一下。常数可能会大。

# $100$ 分安全做法

考虑对答案有贡献的区间。

我们发现，对于一个元素 $x$，记它前 $i$ 次出现的位置为 $last[i][x]$，那么他对答案的贡献区间为 $(last[k][x], last[k - 1][x]]$，此时剩下的相同元素可以全部忽视。考虑离线处理，将所有询问按右端点升序排序，这样统计一个区间的答案时就不会对下一个区间造成影响。

将所有贡献区间的求区间和，这个可以通过树状数组实现，注意贡献区间左开右闭，所以树状数组单点加的应该是 $last[k][x]$。 

输出要按原序。